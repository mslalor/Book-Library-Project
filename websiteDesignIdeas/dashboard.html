<!DOCTYPE html>
<html>
<head>
<title>Personal Library</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src = "accounts.js"></script> 
<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", sans-serif}
</style>
</head>
<body class="w3-light-grey w3-content" style="max-width:1600px">

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
  <div class="w3-container">
    <a href="#" onclick="w3_close()" class="w3-hide-large w3-right w3-jumbo w3-padding w3-hover-grey" title="close menu">
      <i class="fa fa-remove"></i>
    </a>
    <img id ="myPic" src="img/logo.png" style="width:100%;" class="w3-round"><br><br>
    <h4 id = "SideTitle"><b> [InsertUsername]'s Library</b></h4>
  </div>
  <div class="w3-bar-block">
    <a href="#portfolio" onclick="w3_close()" class="w3-bar-item w3-button w3-padding w3-text-teal"><i class="fa fa-th-large fa-fw w3-margin-right"></i>LIBRARY</a> 
    <a href="#contact" onclick="w3_close()" class="w3-bar-item w3-button w3-padding">       ADD NEW BOOK</a>
    <a href = "login.html" style = "padding-left: 8mm;" > Sign out </a>
  </div>
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:300px">

  <!-- Header -->
  <header id="portfolio">
   <!-- <a href="#"><img src="/w3images/avatar_g2.jpg" style="width:65px;" class="w3-circle w3-right w3-margin w3-hide-large w3-hover-opacity"></a>-->
    <span class="w3-button w3-hide-large w3-xxlarge w3-hover-text-grey" onclick="w3_open()"><i class="fa fa-bars"></i></span>
    <div class="w3-container">
    <h1 id = "Title"><b>[InsertUserName]'s Library</b></h1>
    <div class="w3-section w3-bottombar w3-padding-16">
        <!--We will need to add functionality to this -->
      <span class="w3-margin-right">Filter:</span> 
      <button class="w3-button w3-white" onclick = "filterAll()">ALL</button>
      <button class="w3-button w3-white" onclick = "filterLent()"></i>Lent out</button>
      <button class="w3-button w3-white" onclick= "filterIn()"></i>In Library</button>
    </div>
    </div>
  </header>
  
  <!-- First Photo Grid-->

  <div class="w3-row-padding" >
    <div class="w3-third w3-container w3-margin-bottom" id = "book1" hidden>
      <img src="img/potter1.jpg" id = "image1" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title1">Example Book</p>
        <p id = "summ1" >Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit1" class="w3-button w3-black w3-margin-bottom" onclick = "edit(1)"> Lend this book?</button>
        <button id = "remove1" class="w3-button w3-black w3-margin-bottom" onclick = "remove(1)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container w3-margin-bottom" id = "book2" hidden>
      <img src="img/potter7.jpeg" id = "image2" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title2"><b> Example Book</b></p>
        <p id = "summ2">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit2" class="w3-button w3-black w3-margin-bottom" onclick = "edit(2)"> Lend this book?</button>
        <button id = "remove2" class="w3-button w3-black w3-margin-bottom" onclick = "remove(2)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container" id="book3" hidden >
      <img src="img/games1.jpeg" id="image3" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title3"><b> Example Book</b></p>
        <p id = "summ3">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit3" class="w3-button w3-black w3-margin-bottom" onclick = "edit(3)"> Lend this book? </button>
        <button id = "remove3" class="w3-button w3-black w3-margin-bottom" onclick = "remove(3)"> Remove</button>
      </div>
    </div>
  </div>
  <div class="w3-row-padding" >
    <div class="w3-third w3-container w3-margin-bottom" id = "book4" hidden>
      <img src="img/potter1.jpg" id = "image4" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title4">Example Book</p>
        <p id = "summ4" >Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit4" class="w3-button w3-black w3-margin-bottom" onclick = "edit(4)"> Lend this book?</button>
        <button id = "remove4" class="w3-button w3-black w3-margin-bottom" onclick = "remove(4)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container w3-margin-bottom" id = "book5" hidden>
      <img src="img/potter7.jpeg" id = "image5" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title5"><b> Example Book</b></p>
        <p id = "summ5">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit5" class="w3-button w3-black w3-margin-bottom" onclick = "edit(5)"> Lend this book?</button>
        <button id = "remove5" class="w3-button w3-black w3-margin-bottom" onclick = "remove(5)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container" id="book6" hidden >
      <img src="img/games1.jpeg" id="image6" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title6"><b> Example Book</b></p>
        <p id = "summ6">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit6" class="w3-button w3-black w3-margin-bottom" onclick = "edit(6)"> Lend this book?</button>
        <button id = "remove6" class="w3-button w3-black w3-margin-bottom" onclick = "remove(6)"> Remove</button>
      </div>
    </div>
  </div>
  <div class="w3-row-padding" >
    <div class="w3-third w3-container w3-margin-bottom" id = "book7" hidden>
      <img src="img/potter1.jpg" id = "image7" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title7">Example Book</p>
        <p id = "summ7" >Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit7" class="w3-button w3-black w3-margin-bottom" onclick = "edit(7)"> Lend this book?</button>
        <button id = "remove7" class="w3-button w3-black w3-margin-bottom" onclick = "remove(7)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container w3-margin-bottom" id = "book8" hidden>
      <img src="img/potter7.jpeg" id = "image8" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title8"><b> Example Book</b></p>
        <p id = "summ8">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit8" class="w3-button w3-black w3-margin-bottom" onclick = "edit(8)"> Lend this book?</button>
        <button id = "remove8" class="w3-button w3-black w3-margin-bottom" onclick = "remove(8)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container" id="book9" hidden >
      <img src="img/games1.jpeg" id="image9" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title9"><b> Example Book</b></p>
        <p id = "summ9">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit9" class="w3-button w3-black w3-margin-bottom" onclick = "edit(9)"> Lend this book?</button>
        <button id = "remove9" class="w3-button w3-black w3-margin-bottom" onclick = "remove(9)"> Remove</button>
      </div>
    </div>
  </div>
  <div class="w3-row-padding" >
    <div class="w3-third w3-container w3-margin-bottom" id = "book10" hidden>
      <img src="img/potter1.jpg" id = "image10" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title10">Example Book</p>
        <p id = "summ10" >Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit10" class="w3-button w3-black w3-margin-bottom" onclick = "edit(10)"> Lend this book?</button>
        <button id = "remove10" class="w3-button w3-black w3-margin-bottom" onclick = "remove(10)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container w3-margin-bottom" id = "book11" hidden>
      <img src="img/potter7.jpeg" id = "image11" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title11"><b> Example Book</b></p>
        <p id = "summ11">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit11" class="w3-button w3-black w3-margin-bottom" onclick = "edit(11)"> Lend this book?</button>
        <button id = "remove11" class="w3-button w3-black w3-margin-bottom" onclick = "remove(11)"> Remove</button>
      </div>
    </div>
    <div class="w3-third w3-container" id="book12" hidden >
      <img src="img/games1.jpeg" id="image12" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "title12"><b> Example Book</b></p>
        <p id = "summ12">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <button id = "edit12" class="w3-button w3-black w3-margin-bottom" onclick = "edit(12)"> Lend this book?</button>
        <button id = "remove12" class="w3-button w3-black w3-margin-bottom" onclick = "remove(12)"> Remove</button>
      </div>
    </div>
  </div>
  
  <div class="w3-container w3-padding-large" id = "renter" style="margin-bottom: 10mm" hidden>

    <!-- Add book sectionn -->
    <div class="w3-container w3-padding-large w3-grey">
      <h4 id="contact"><b>Who did you rent this to?(Email) </b></h4>
      <input id="inputEmail">
      <h4 id="contact"><b>What is the date? </b></h4>
      <input id = "inputDate">
      <h4 id="contact"><b>In how many weeks should we start sending reminder emails? </b></h4>
      <input id = "inputWeeks">
      <button onclick="checkOut()">Submit!</button><br>
      <div id="output"></div>
    </div>
  </div>

  <div class="w3-container w3-padding-large" style="margin-bottom: 10mm">

  <!-- Add book sectionn -->
  <div class="w3-container w3-padding-large w3-grey">
    <h4 id="contact"><b>Add Book </b></h4>

    <input id="input">
    <button onclick="getbooks()">Get books</button><br>
    <div id="output"></div>

<div class="w3-row-padding"  id = "searchResults">
    <div class="w3-third w3-container" id="result1"  style = 'margin-bottom: 10px' hidden>
      <img src="img/games1.jpeg" id="cover1" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "search1"><b> Example Book</b></p>
        <p id = "info1">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <p id = "isbn1">0000</p>
        <button id = "add1" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(1)"> Add to Library!</button>
      </div>
    </div>
    <div class="w3-third w3-container" id="result2" style = 'margin-bottom: 10px' hidden>
      <img src="img/games1.jpeg" id="cover2" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "search2"><b> Example Book</b></p>
        <p id = "info2">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <p id = "isbn2">0000</p>
        <button id = "add2" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(2)"> Add to Library!</button>
    </div>
    </div>
    <div class="w3-third w3-container" id="result3" style = 'margin-bottom: 10px'  hidden>
        <img src="img/games1.jpeg" id="cover3" style="width:100%" class="w3-hover-opacity">
        <div class="w3-container w3-white">
          <p id = "search3"><b> Example Book</b></p>
          <p id = "info3">Here would be the author, summary? ISBN info, and if it is available or not</p>
          <p id = "isbn3">0000</p>
          <button id = "add3" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(3)"> Add to Library!</button>
        </div>
    </div>
    </div>

<div class="w3-row-padding"  id = "searchResults">
    <div class="w3-third w3-container" id="result4" style = 'margin-bottom: 10px'  hidden>
        <img src="img/games1.jpeg" id="cover4" style="width:100%" class="w3-hover-opacity">
        <div class="w3-container w3-white">
          <p id = "search4"><b> Example Book</b></p>
          <p id = "info4">Here would be the author, summary? ISBN info, and if it is available or not</p>
          <p id = "isbn4">0000</p>
          <button id = "add4" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(4)"> Add to Library!</button>
        </div>
    </div>
    <div class="w3-third w3-container" id="result5" style = 'margin-bottom: 10px'  hidden>
          <img src="img/games1.jpeg" id="cover5" style="width:100%" class="w3-hover-opacity">
          <div class="w3-container w3-white">
            <p id = "search5"><b> Example Book</b></p>
            <p id = "info5">Here would be the author, summary? ISBN info, and if it is available or not</p>
            <p id = "isbn5">0000</p>
            <button id = "add5" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(5)"> Add to Library!</button>
          </div>
    </div>
    <div class="w3-third w3-container" id="result6" style = 'margin-bottom: 10px'  hidden>
            <img src="img/games1.jpeg" id="cover6" style="width:100%" class="w3-hover-opacity">
            <div class="w3-container w3-white">
              <p id = "search6"><b> Example Book</b></p>
              <p id = "info6">Here would be the author, summary? ISBN info, and if it is available or not</p>
              <p id = "isbn6">0000</p>
              <button id = "add6" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(6)"> Add to Library!</button>
            </div>
    </div>
    </div>
<div class="w3-row-padding"  id = "searchResults"></div>
    <div class="w3-third w3-container" id="result7" style = 'margin-bottom: 10px'  hidden>
              <img src="img/games1.jpeg" id="cover7" style="width:100%" class="w3-hover-opacity">
              <div class="w3-container w3-white">
                <p id = "search7"><b> Example Book</b></p>
                <p id = "info7">Here would be the author, summary? ISBN info, and if it is available or not</p>
                <p id = "isbn7">0000</p>
                <button id = "add7" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(7)"> Add to Library!</button>
              </div>
    </div>
    <div class="w3-third w3-container" id="result8" style = 'margin-bottom: 10px'  hidden>
      <img src="img/games1.jpeg" id="cover8" style="width:100%" class="w3-hover-opacity">
      <div class="w3-container w3-white">
        <p id = "search8"><b> Example Book</b></p>
        <p id = "info8">Here would be the author, summary? ISBN info, and if it is available or not</p>
        <p id = "isbn8">0000</p>
        <button id = "add8" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(8)"> Add to Library!</button>
      </div>
</div>
<div class="w3-third w3-container" id="result9" style = 'margin-bottom: 10px'  hidden>
  <img src="img/games1.jpeg" id="cover9" style="width:100%" class="w3-hover-opacity">
  <div class="w3-container w3-white">
    <p id = "search9"><b> Example Book</b></p>
    <p id = "info9">Here would be the author, summary? ISBN info, and if it is available or not</p>
    <p id = "isbn9">0000</p>
    <button id = "add9" class="w3-button w3-black w3-margin-bottom" onclick = "addBook(9)"> Add to Library!</button>
  </div>
</div>

  </div>



</div>
</div>

  
  
<!-- End page content -->
</div>

<script>


//var id = getID();
var id = localStorage.getItem("userId");
var user = getAccount(id);
let userName = user.username;
document.getElementById('SideTitle').innerHTML = userName + "'s Library";
document.getElementById('Title').innerHTML = userName + "'s Library";
getBooks(user);



for(var i = 0; i< user.numBooks; i++){
  var j = i+1;
  var book = document.getElementById('book'+j);
  document.getElementById('title'+j).innerHTML = user.bookList[i].title;;
  document.getElementById('summ'+j).innerHTML ="Author: " + user.bookList[i].author + " ISBN:  " +user.bookList[i].isbn;
  document.getElementById("image"+j).src = user.bookList[i].img;
  book.removeAttribute("hidden");
  
}

function edit(num){
  if(user.bookList[num-1].status == "In Library"){
    user.bookList[num-1].status = "Lent Out Pending";
    //go to lending html somehow
    var box = document.getElementById('renter');
    box.removeAttribute('hidden');
    document.getElementById('edit'+num).innerHTML = "Please input information in the box below";
  }else{
    user.bookList[num-1].status = "In Library";
    document.getElementById('edit'+num).innerHTML = "Lend this book?"
  }
  document.getElementById('summ'+num).innerHTML ="Author: " + user.bookList[num-1].author + " ISBN:  " +user.bookList[num-1].isbn;
  
}

function checkOut(){
 var email = document.getElementById("inputEmail").value;
 var date = document.getElementById("inputDate").value;
 var weeks = document.getElementById("inputWeeks").value;
 

  for(var i = 0; i < user.numBooks; i++){
    if(user.bookList[i].status == "Lent Out Pending"){
        user.bookList[i].marked(email, date, weeks);
        user.bookList[i].status = "Lent Out";
        document.getElementById('edit'+(i+1)).innerHTML = "Rented to: " + user.bookList[i].renterEmail +"\n"+  "Returned?";
        var box = document.getElementById('renter');
        box.setAttribute('hidden', true);
       // console.log(user.bookList[i].title + " to "  + user.bookList[i].renterEmail);
        break;
    }
  }

  
}

function filterAll(){
  for(var i = 0; i< user.numBooks; i++){
  var j = i+1;
  var book = document.getElementById('book'+j);
  book.removeAttribute("hidden");
}
}

function filterIn(){
  for(var i = 0; i< user.numBooks; i++){
  var j = i+1;
  var book = document.getElementById('book'+j);
  if(user.bookList[i].status == "In Library"){
      book.removeAttribute("hidden");
  }else{
    book.setAttribute("hidden", true);
  }
}
}
function filterLent(){
  for(var i = 0; i< user.numBooks; i++){
  var j = i+1;
  var book = document.getElementById('book'+j);
  if(user.bookList[i].status == "Lent Out"){
      book.removeAttribute("hidden");
  }else{
    book.setAttribute("hidden", true);
  }
}
}

function w3_open() {
    document.getElementById("mySidebar").style.display = "block";
    document.getElementById("myOverlay").style.display = "block";
}
 
function w3_close() {
    document.getElementById("mySidebar").style.display = "none";
    document.getElementById("myOverlay").style.display = "none";
}


function addBook(num){
  var searched = document.getElementById('result'+num);
  var title = document.getElementById("search" + num).innerHTML;
  var author = document.getElementById("info"+num).innerHTML;
  var isbn = document.getElementById("isbn"+num).innerHTML;
  if(!document.getElementById("cover"+num).src){
    var source = 'img/noimage.jpeg';
  }else{
    var source = document.getElementById("cover"+num).src;
  }

 // console.log("title: " + title);

  let newBook = new Book(title, author, isbn, "In Library", source)
  user.addBook(newBook);
  //console.log(user.numBooks);
  //console.log(user.bookList[user.numBooks-1].title);

  var j = user.numBooks;
  var i = user.numBooks - 1;
  //console.log(i + "= i"); 
  var book = document.getElementById('book'+j);
  document.getElementById('title'+j).innerHTML = user.bookList[i].title;
  document.getElementById('summ'+j).innerHTML ="Author: " + user.bookList[i].author + " ISBN:  " +user.bookList[i].isbn;
  document.getElementById("image"+j).src = user.bookList[i].img;
  book.removeAttribute("hidden");

  document.getElementById('input').innerHTML = "";
  for(var i = 0; i<9; i++){
    j = i +1;
    var searched = document.getElementById('result'+j);
    searched.setAttribute("hidden", true);
  }

}

function getbooks(){
    document.getElementById('output').innerHTML="Searching...";
    fetch("https://openlibrary.org/search.json?q=" + document.getElementById("input").value)
    .then(a => a.json())
    .then(response =>{
        // clear "searching..." before displaying results
        document.getElementById('output').innerHTML = "";
        for (var i = 0; i < 9; i++){
          //  console.log("here "+ i );
            j = i +1;
            var searched = document.getElementById('result'+j);
            document.getElementById("search"+j).innerHTML = response.docs[i].title;
            document.getElementById("info"+j).innerHTML = response.docs[i].author_name[0];
            document.getElementById("isbn"+j).innerHTML = response.docs[i].isbn[0]
            if('https://covers.openlibrary.org/b/isbn/'+response.docs[i].isbn[0]+'-M.jpg' == null){
                document.getElementById("cover"+j).src = 'img/noimage.jpeg';
            }else{
                document.getElementById("cover"+j).src = 'https://covers.openlibrary.org/b/isbn/'+response.docs[i].isbn[0]+'-M.jpg';
            }
            searched.removeAttribute("hidden");
        }
    });
}


function remove(num){
  console.log("removing " + num);
  var book = document.getElementById('book'+num);
  var place = num - 1; 

  if(num == user.numBooks){
    book.setAttribute("hidden", true);
    user.numBooks = user.numBooks - 1;
    console.log(user.numBooks);
    return;
  }
  for(var i = place; i<user.numBooks; i++){
    console.log((i+1) + " replacing " + i);
    user.bookList[i] = user.bookList[i+1];
  }

  user.numBooks = user.numBooks -1;

  for(var i = 0; i< user.numBooks; i++){
  var j = i+1;
  var book = document.getElementById('book'+j);
  document.getElementById('title'+j).innerHTML = user.bookList[i].title;;
  document.getElementById('summ'+j).innerHTML ="Author: " + user.bookList[i].author + " ISBN:  " +user.bookList[i].isbn;
  document.getElementById("image"+j).src = user.bookList[i].img;
  document.getElementById("edit"+j).innerHTML = "test";
 // book.removeAttribute("hidden");
  console.log("displaying: " + j + " which is at index " + i);
  
  }
  console.log("j " + j);
  var book = document.getElementById('book'+j);
  book.setAttribute("hidden", true);
  console.log("numbooks " + user.numBooks);

}
</script>

</body>
</html>
